ScriptLoader.load("Toolbar","ModalBox");var FeedToolbar=new Class({Extends:Toolbar,Implements:Energine.request,initialize:function(e){Asset.css("pagetoolbar.css");Asset.css("feedtoolbar.css");this.parent("feed_toolbar");this.bindTo(this);this.dock();this.feedElementType=false;this.element.injectInside(document.getElement(".e-topframe"));var d=$$("html")[0];if(d.hasClass("e-has-topframe1")){d.removeClass("e-has-topframe1");d.addClass("e-has-topframe2")}if(d.hasClass("e-has-topframe2")){d.removeClass("e-has-topframe2");d.addClass("e-has-topframe3")}this.load(e);this.singlePath=e.getProperty("single_template");var f=$(e.getProperty("linkedTo"));this.disableControls();if(f){this._prepareDataSet(f);if(this.selected=f.getProperty("current")){this.feedElementType="form";this.enableControls("add","edit")}else{this.feedElementType="list";this.enableControls("add");this.selected=false}}e.dispose();this.previous=false},add:function(){ModalBox.open({url:this.singlePath+"add/",onClose:function(b){if(b=="add"){this.add()}else{if(b){this._reload(true)}}}.bind(this)})},edit:function(){ModalBox.open({url:this.singlePath+this.selected+"/edit/",onClose:this._reload.bind(this)})},del:function(){var b=Energine.translations.get("MSG_CONFIRM_DELETE]")||"Do you really want to delete selected record?";if(confirm(b)){this.request(this.singlePath+this.selected+"/delete/",null,this._reload)}},up:function(){this.request(this.singlePath+this.selected+"/up/",null,this._aftermove.pass("up",this))},down:function(){this.request(this.singlePath+this.selected+"/down/",null,this._aftermove.pass("down",this))},_aftermove:function(f){try{if(f=="up"){var d=this.previous.getPrevious();if(!d.getProperty("record")){throw"error"}$(this.previous).injectBefore(d)}else{$(this.previous).injectAfter(this.previous.getNext())}}catch(e){this._reload(true)}},_select:function(c,d){if(this.previous){this.previous.removeClass("record_select")}if(this.previous==d){this.selected=this.previous=false;this.disableControls(),this.enableControls("add")}else{this.previous=d;d.addClass("record_select");this.selected=d.getProperty("record");this.enableControls()}},_prepareDataSet:function(c){var c,d;d=c.getElements("[record]");if(d.length){c.addClass("active_component");c.fade(0.7);d.each(function(a){a.addEvent("mouseover",function(){this.addClass("record_highlight")});a.addEvent("mouseout",function(){this.removeClass("record_highlight")});a.addEvent("click",this._select.bindWithEvent(this,a))},this)}},_reload:function(c){if(c){var d=new Element("form").setProperties({action:"",method:"POST"});d.adopt(new Element("input").setProperty("name","editMode").setProperty("type","hidden"));document.body.adopt(d);d.submit()}}});