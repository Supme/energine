ScriptLoader.load("Toolbar","ModalBox");var FeedToolbar=new Class({Extends:Toolbar,Implements:Energine.request,initialize:function(a){Asset.css("pagetoolbar.css");Asset.css("feedtoolbar.css");this.parent("feed_toolbar");this.bindTo(this);this.dock();this.feedElementType=false;this.element.injectInside(document.getElement(".e-topframe"));var b=$$("html")[0];if(b.hasClass("e-has-topframe1")){b.removeClass("e-has-topframe1");b.addClass("e-has-topframe2")}if(b.hasClass("e-has-topframe2")){b.removeClass("e-has-topframe2");b.addClass("e-has-topframe3")}this.load(a);this.singlePath=a.getProperty("single_template");var c=$(a.getProperty("linkedTo"));this.disableControls();if(c){this._prepareDataSet(c);if(this.selected=c.getProperty("current")){this.feedElementType="form";this.enableControls("add","edit")}else{this.feedElementType="list";this.enableControls("add");this.selected=false}}a.dispose();this.previous=false},add:function(){ModalBox.open({url:this.singlePath+"add/",onClose:function(a){if(a=="add"){this.add()}else{if(a){this._reload(true)}}}.bind(this)})},edit:function(){ModalBox.open({url:this.singlePath+this.selected+"/edit/",onClose:this._reload.bind(this)})},del:function(){var a=Energine.translations.get("MSG_CONFIRM_DELETE]")||"Do you really want to delete selected record?";if(confirm(a)){this.request(this.singlePath+this.selected+"/delete/",null,this._reload)}},up:function(){this.request(this.singlePath+this.selected+"/up/",null,this._aftermove.pass("up",this))},down:function(){this.request(this.singlePath+this.selected+"/down/",null,this._aftermove.pass("down",this))},_aftermove:function(c){try{if(c=="up"){var b=this.previous.getPrevious();if(!b.getProperty("record")){throw"error"}$(this.previous).injectBefore(b)}else{$(this.previous).injectAfter(this.previous.getNext())}}catch(a){this._reload(true)}},_select:function(b,a){if(this.previous){this.previous.removeClass("record_select")}if(this.previous==a){this.selected=this.previous=false;this.disableControls(),this.enableControls("add")}else{this.previous=a;a.addClass("record_select");this.selected=a.getProperty("record");this.enableControls()}},_prepareDataSet:function(b){var b,a;a=b.getElements("[record]");if(a.length){b.addClass("active_component");b.fade(0.7);a.each(function(c){c.addEvent("mouseover",function(){this.addClass("record_highlight")});c.addEvent("mouseout",function(){this.removeClass("record_highlight")});c.addEvent("click",this._select.bindWithEvent(this,c))},this)}},_reload:function(b){if(b){var a=new Element("form").setProperties({action:"",method:"POST"});a.adopt(new Element("input").setProperty("name","editMode").setProperty("type","hidden"));document.body.adopt(a);a.submit()}}});