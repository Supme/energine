ScriptLoader.load("View");var DirView=new Class({Extends:View,getOptions:function(){return Object.extend(this.parent(),{onEdit:$empty,onOpen:$empty})},initialize:function(b,a){Asset.css("filemanager.css");this.parent(b,a);if(!(document.getElement(".e-singlemode-layout"))){window.addEvent("resize",this.fitFilemanagerFormSize.bind(this))}},build:function(){if(!this.metadata){alert("View have no metadata.");return}this.clear();this.data.each(function(b){this.addRecord(b)},this);var a=this.element.getFirst();if(a){this.selectItem(a)}if(!(document.getElement(".e-singlemode-layout"))){this.pane=this.element.getParents(".e-pane")[0];this.paneContent=this.pane.getElement(".e-pane-item");this.filemanager=this.element;this.minPaneHeight=300;this.fitFilemanagerFormSize();new Fx.Scroll(document.getElement(".e-mainframe")?document.getElement(".e-mainframe"):window).toElement(this.pane)}},fitFilemanagerFormSize:function(){var e=window.getSize().y-10;var b=this.pane.getSize().y;var d=this.filemanager.getSize().y;var a=this.paneContent.getSize().y-22;var c=b-a;if(e>this.minPaneHeight){if((d+c)>e){this.pane.setStyle("height",e)}else{this.pane.setStyle("height",d+c)}}else{this.pane.setStyle("height",this.minPaneHeight)}},clear:function(){this.selectItem(false);while(this.element.hasChildNodes()){this.element.removeChild(this.element.firstChild)}},addRecord:function(a){for(var d in a){if(!this.metadata[d]){alert("DirView: record doesn't conform to metadata.");return false}}var c=new Element("div").setProperty("title",a.upl_name).injectInside(this.element);new Element("div").addClass("name").set("html",a.upl_name).injectInside(c);if($type(a.upl_data.thumb)=="string"){new Element("img").setProperty("src",a.upl_data.thumb).injectInside(c)}else{new Element("div").addClass(a.className).injectInside(c)}c.obj=a;var b=this;c.addEvents({mouseover:function(){if(this!=b.getSelectedItem()){this.addClass("highlighted")}},mouseout:function(){this.removeClass("highlighted")},click:function(){if(this!=b.getSelectedItem()){b.selectItem(this)}},dblclick:this.fireEvent.pass("onOpen",this)})},switchMode:function(){var b=this.getSelectedItem().getElement("div.name");if(b){var a=new Element("input").setProperties({type:"text",value:b.innerHTML}).addClass("name");a.replaces(b);a.select();a.focus();a.addEvent("blur",this.edit.bind(this))}else{var a=this.getSelectedItem().getElement("input.name");var b=new Element("div").addClass("name").set("html",a.get("value"));b.replaces(a)}},edit:function(){this.switchMode();this.fireEvent("onEdit","dummy")}});