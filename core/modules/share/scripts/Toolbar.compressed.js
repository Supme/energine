var Toolbar=new Class({imagesPath:"",initialize:function(a){Asset.css("toolbar.css");this.name=a;this.element=new Element("ul").addClass("toolbar").addClass("clearfix");if(this.name){this.element.addClass(this.name)}this.controls=[]},dock:function(){this.element.addClass("docked_toolbar")},undock:function(){this.element.removeClass("docked_toolbar")},getElement:function(){return this.element},bindTo:function(a){this.boundTo=a;return this},load:function(a){$A(a.childNodes).each(function(b){if(b.nodeType==1){var c=null;switch(b.getAttribute("type")){case"button":c=new Toolbar.Button;break;case"separator":c=new Toolbar.Separator;break}if(c){c.load(b);this.appendControl(c)}}}.bind(this))},appendControl:function(a){if($chk(a.type)&&$chk(a.id)){a.action=a.onclick;delete a.onclick;a=new Toolbar[a.type.capitalize()](a)}if(a instanceof Toolbar.Control){a.toolbar=this;a.build();this.element.adopt(a.element);this.controls.push(a)}return this},removeControl:function(a){if($type(a)=="string"){a=this.getControlById(a)}if(a instanceof Toolbar.Control){this.controls.each(function(c,b){if(c==a){c.toolbar=null;c.element.dispose();this.controls.splice(b,1)}},this)}return this},getControlById:function(b){for(var a=0;a<this.controls.length;a++){if(this.controls[a].properties.id==b){return this.controls[a]}}return false},disableControls:function(){if(!arguments.length){this.controls.each(function(b){if(b.properties.id!="close"){b.disable()}})}else{var a;$A(arguments).each(function(b){if(a=this.getControlById(b)){a.disable()}},this)}return this},enableControls:function(){if(!arguments.length){this.controls.each(function(b){b.enable()})}else{var a;$A(arguments).each(function(b){if(a=this.getControlById(b)){a.enable()}},this)}return this},_callAction:function(a,b){if(this.boundTo&&$type(this.boundTo[a])=="function"){this.boundTo[a](b)}}});Toolbar.Control=new Class({toolbar:null,initialize:function(a){this.properties={id:null,icon:null,title:"",tooltip:"",action:null,disabled:false};$extend(this.properties,$pick(a,{}))},load:function(a){this.properties.id=a.getAttribute("id")||"";this.properties.icon=a.getAttribute("icon")||"";this.properties.title=a.getAttribute("title")||"";this.properties.action=a.getAttribute("action")||"";this.properties.tooltip=a.getAttribute("tooltip")||"";this.properties.disabled=a.getAttribute("disabled")?true:false},build:function(){if(!this.toolbar||!this.properties.id){return false}this.element=new Element("li").setProperty("unselectable","on");if(this.properties.icon){this.element.addClass("icon unselectable").setProperty("id",this.toolbar.name+this.properties.id).setProperty("title",this.properties.title+(this.properties.tooltip?" ("+this.properties.tooltip+")":"")).setStyle("-moz-user-select","none").setStyle("background-image","url("+Energine.base+this.toolbar.imagesPath+this.properties.icon+")")}else{this.element.setProperty("title",this.properties.tooltip).appendText(this.properties.title)}if(this.properties.disabled){this.disable()}},disable:function(){if(!this.properties.disabled){this.properties.disabled=true;this.element.addClass("disabled").setOpacity(0.25)}},enable:function(){if(this.properties.disabled){this.properties.disabled=false;this.element.removeClass("disabled").setOpacity(1)}},setAction:function(a){this.properties.action=a}});Toolbar.Button=new Class({Extends:Toolbar.Control,build:function(){this.parent();var a=this;this.element.addEvents({mouseover:function(){if(!a.properties.disabled){this.addClass("highlighted")}},mouseout:function(){this.removeClass("highlighted")},click:function(){if(!a.properties.disabled){a.toolbar._callAction(a.properties.action)}}})}});Toolbar.Switcher=new Class({Extends:Toolbar.Button,initialize:function(a){this.parent(a);this.properties.state=new Boolean(this.properties.state.toInt()).valueOf()},build:function(){this.parent();var a=(function(){if(this.properties.state){this.element.addClass("pressed")}else{this.element.removeClass("pressed")}}).bind(this);this.element.addEvent("click",function(){if(!this.properties.disabled){this.properties.state=(!this.properties.state);a()}}.bind(this));a()},getState:function(){return this.properties.state}});Toolbar.Separator=new Class({Extends:Toolbar.Control,build:function(){this.parent();this.element.addClass("separator")},disable:function(){}});Toolbar.Select=new Class({Extends:Toolbar.Control,select:null,toolbar:null,initialize:function(b,a){this.properties={id:null,title:"",tooltip:"",action:null,disabled:false};$extend(this.properties,$pick(b,{}));this.options=a||{}},build:function(){if(!this.toolbar||!this.properties.id){return false}this.element=new Element("li").setProperty("unselectable","on").addClass("select");if(this.properties.title){this.element.adopt(new Element("span").addClass("label").set("text",this.properties.title))}this.select=new Element("select");var a=this;this.select.addEvent("change",function(){a.toolbar._callAction(a.properties.action,a)});this.element.adopt(this.select);if(this.properties.disabled){this.disable()}$H(this.options).each(function(c,b){a.select.adopt(new Element("option").setProperties({value:b}).set("text",c))})},disable:function(){if(!this.properties.disabled){this.properties.disabled=true;this.select.setProperty("disabled","disabled")}},enable:function(){if(this.properties.disabled){this.properties.disabled=false;this.select.removeProperty("disabled")}},setAction:function(a){this.properties.action=a},getValue:function(){return this.select.getSelected().getLast().get("value")},setSelected:function(a){if(this.options[a]){if(this.select){this.select.getElement("option[value="+a+"]").setProperty("selected","selected")}else{}}}});