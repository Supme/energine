ScriptLoader.load("Overlay");var ModalBox=window.top.ModalBox||{boxes:[],init:function(){Asset.css("modalbox.css");this.overlay=new Overlay(document.body,{indicator:false});this.initialized=true},open:function(b){var c=new Element("div").addClass("e-modalbox").injectInside(document.body);c.options={url:null,onClose:$empty,extraData:null,post:null};$extend(c.options,$pick(b,{}));if(c.options.url){var e=c.options.url,d="modalBoxIframe"+this.boxes.length.toString();if(c.options.post){var a=new Element("form",{target:d,action:e,method:"post"}).grab(new Element("input",{type:"hidden",name:"modalBoxData",value:c.options.post}));e="about:blank"}if(Browser.Engine.trident){iframe=$(document.createElement('<iframe class="e-modalbox-frame" src="'+e+'" frameBorder="0" name="'+d+'" scrolling="no" />'))}else{iframe=new Element("iframe").setProperties({name:d,src:e,frameBorder:"0",scrolling:"no","class":"e-modalbox-frame"})}c.iframe=iframe.injectInside(c);if(c.options.post){c.grab(a);a.submit();a.destroy()}}else{if(c.options.code){c.grab(c.options.code)}}c.closeButton=new Element("div").addClass("e-modalbox-close").injectInside(c);c.closeButton.addEvents({click:this.close.bind(this),mouseover:function(){this.addClass("highlighted")},mouseout:function(){this.removeClass("highlighted")}});this.boxes.push(c);if(this.boxes.length==1){this.overlay.show()}},getCurrent:function(){return this.boxes[this.boxes.length-1]},getExtraData:function(){var a=null;if(this.getCurrent()){a=this.getCurrent().options.extraData}return a},setReturnValue:function(a){this.getCurrent().store("returnValue",a)},close:function(){if(!this.boxes.length){return}var b=this.boxes.pop();b.options.onClose(b.retrieve("returnValue"));var a=function(){if(b.iframe){b.iframe.setProperty("src","about:blank");b.iframe.destroy()}b.destroy()};a.delay(1);if(!this.boxes.length){this.overlay.hide()}},keyboardListener:function(a){switch(a.key){case"esc":this.close();break}}};if(!ModalBox.initialized){window.addEvent("domready",ModalBox.init.bind(ModalBox))};