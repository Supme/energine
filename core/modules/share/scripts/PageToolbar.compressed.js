ScriptLoader.load("Toolbar","ModalBox");var PageToolbar=new Class({Extends:Toolbar,initialize:function(c,b,a,d){this.parent(a);Asset.css("pagetoolbar.css");this.componentPath=c;this.documentId=b;this.layoutManager=false;this.dock();this.bindTo(this);if(d){d.each(function(e){this.appendControl(e)},this)}this.setupLayout()},setupLayout:function(){var b=$$("html")[0];if(!b.hasClass("e-has-topframe1")){b.addClass("e-has-topframe1")}if((Cookie.read("sidebar")==null)||(Cookie.read("sidebar")==1)){$$("html")[0].addClass("e-has-sideframe")}var f=$(document.body).getChildren().filter(function(h){return(!(h.hasClass("e-overlay")))});var a=new Element("div",{"class":"e-mainframe"});var g=new Element("div",{"class":"e-topframe"});var e=new Element("div",{"class":"e-sideframe"});var c=new Element("div",{"class":"e-sideframe-content"});var d=new Element("div",{"class":"e-sideframe-border"});$(document.body).adopt([g,a,e]);a.adopt(f);e.adopt([c,d]);g.grab(this.element);new Element("iframe").setProperties({src:this.componentPath+"show/",frameBorder:"0"}).injectInside(c);if((this.getControlById("editMode").getState()==1)&&(this.getControlById("editBlocks"))){ScriptLoader.load("LayoutManager");this.getControlById("editBlocks").enable()}},editMode:function(){if(this.getControlById("editMode").getState()==0){this._reloadWindowInEditMode()}else{window.location=window.location}},add:function(){ModalBox.open({url:this.componentPath+"add/"+this.documentId})},edit:function(){ModalBox.open({url:this.componentPath+this.documentId+"/edit"})},toggleSidebar:function(){$$("html")[0].toggleClass("e-has-sideframe");Cookie.write("sidebar",$$("html")[0].hasClass("e-has-sideframe")?1:0,{path:new URI(Energine.base).get("directory"),duration:1})},showTmplEditor:function(){ModalBox.open({url:this.componentPath+"template"})},showTransEditor:function(){ModalBox.open({url:this.componentPath+"translation"})},showUserEditor:function(){ModalBox.open({url:this.componentPath+"user"})},showRoleEditor:function(){ModalBox.open({url:this.componentPath+"role"})},showLangEditor:function(){ModalBox.open({url:this.componentPath+"languages"})},showFileRepository:function(){ModalBox.open({url:this.componentPath+"file-library"})},editBlocks:function(){if(!this.getControlById("editBlocks").getState()){this.layoutManager=new LayoutManager(this.componentPath)}else{if(this.layoutManager&&LayoutManager.changed){new Request.JSON({url:this.componentPath+"widgets/save-content/",method:"post",evalScripts:false,data:'xml=<?xml version="1.0" encoding="utf-8" ?>'+XML.hashToHTML(XML.nodeToHash(this.layoutManager.xml)),onSuccess:function(a){if(a.result){this._reloadWindowInEditMode()}}.bind(this)}).send()}else{this._reloadWindowInEditMode()}}},_reloadWindowInEditMode:function(){new Element("form",{styles:{display:"none"}}).setProperties({action:"",method:"post"}).grab(new Element("input").setProperty("name","editMode").setProperties({type:"hidden",value:"1"})).inject(document.body).submit()}});